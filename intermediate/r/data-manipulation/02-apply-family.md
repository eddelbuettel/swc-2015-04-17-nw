

# Learning the apply family of functions

One of the greatest joys of vectorized operations is being able to use the entire family of `apply` functions that are available in base `R`.

These include:


```r
apply
by
lapply
tapply
sapply
```

## apply

`apply` applies a function to each row or column of a matrix.


```r
m <- matrix(c(1:10, 11:20), nrow = 10, ncol = 2)
m
```

```
##       [,1] [,2]
##  [1,]    1   11
##  [2,]    2   12
##  [3,]    3   13
##  [4,]    4   14
##  [5,]    5   15
##  [6,]    6   16
##  [7,]    7   17
##  [8,]    8   18
##  [9,]    9   19
## [10,]   10   20
```

```r
# 1 is the row index
# 2 is the column index
apply(m, 1, sum)
```

```
##  [1] 12 14 16 18 20 22 24 26 28 30
```

```r
apply(m, 2, sum)
```

```
## [1]  55 155
```

```r
apply(m, 1, mean)
```

```
##  [1]  6  7  8  9 10 11 12 13 14 15
```

```r
apply(m, 2, mean)
```

```
## [1]  5.5 15.5
```

## by

`by` applies a function to subsets of a data frame.


```r
head(iris)
```

```
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa
```

```r
by(iris[, 1:2], iris[,"Species"], summary)
```

```
## iris[, "Species"]: setosa
##   Sepal.Length    Sepal.Width   
##  Min.   :4.300   Min.   :2.300  
##  1st Qu.:4.800   1st Qu.:3.200  
##  Median :5.000   Median :3.400  
##  Mean   :5.006   Mean   :3.428  
##  3rd Qu.:5.200   3rd Qu.:3.675  
##  Max.   :5.800   Max.   :4.400  
## -------------------------------------------------------- 
## iris[, "Species"]: versicolor
##   Sepal.Length    Sepal.Width   
##  Min.   :4.900   Min.   :2.000  
##  1st Qu.:5.600   1st Qu.:2.525  
##  Median :5.900   Median :2.800  
##  Mean   :5.936   Mean   :2.770  
##  3rd Qu.:6.300   3rd Qu.:3.000  
##  Max.   :7.000   Max.   :3.400  
## -------------------------------------------------------- 
## iris[, "Species"]: virginica
##   Sepal.Length    Sepal.Width   
##  Min.   :4.900   Min.   :2.200  
##  1st Qu.:6.225   1st Qu.:2.800  
##  Median :6.500   Median :3.000  
##  Mean   :6.588   Mean   :2.974  
##  3rd Qu.:6.900   3rd Qu.:3.175  
##  Max.   :7.900   Max.   :3.800
```

```r
by(iris[, 1:2], iris[,"Species"], sum)
```

```
## iris[, "Species"]: setosa
## [1] 421.7
## -------------------------------------------------------- 
## iris[, "Species"]: versicolor
## [1] 435.3
## -------------------------------------------------------- 
## iris[, "Species"]: virginica
## [1] 478.1
```


## tapply

`tapply` applies a function to subsets of a vector.


```r
df <- data.frame(names = sample(c("A","B","C"), 10, rep = T), length = rnorm(10))
df
```

```
##    names      length
## 1      C  0.03537461
## 2      C  1.60992211
## 3      B -0.84385476
## 4      C  1.17613917
## 5      C  0.99353726
## 6      A -0.36900536
## 7      B  1.94256127
## 8      C -1.14226480
## 9      C -1.21433457
## 10     C  1.06886195
```

```r
tapply(df$length, df$names, mean)
```

```
##          A          B          C 
## -0.3690054  0.5493533  0.3610337
```

Now with a more familiar dataset.


```r
tapply(iris$Petal.Length, iris$Species, mean)
```

```
##     setosa versicolor  virginica 
##      1.462      4.260      5.552
```

## lapply (and llply)

What it does: Returns a list of same length as the input. 
Each element of the output is a result of applying a function to the corresponding element.


```r
my_list <- list(a = 1:10, b = 2:20)
my_list
```

```
## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1]  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
```

```r
lapply(my_list, mean)
```

```
## $a
## [1] 5.5
## 
## $b
## [1] 11
```



## sapply

`sapply` is a more user friendly version of `lapply` and will return a list of matrix where appropriate.


Let's work with the same list we just created.


```r
my_list
```

```
## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1]  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20
```

```r
x <- sapply(my_list, mean)
x
```

```
##    a    b 
##  5.5 11.0
```

```r
class(x)
```

```
## [1] "numeric"
```

## replicate

An extremely useful function to generate datasets for simulation purposes. 


```r
replicate(10, rnorm(10))
```

```
##              [,1]       [,2]        [,3]        [,4]         [,5]
##  [1,] -1.10285895 -0.8875199 -1.45828714  1.98428194  0.012170093
##  [2,] -0.73022326  0.1579900  0.05920901  0.88694373  0.197815373
##  [3,] -1.21752339  1.2173111  1.62506015 -0.57196300 -0.139726186
##  [4,] -1.18868711 -0.6876430 -1.86148790 -2.08041011  1.220924477
##  [5,]  1.18025503 -0.5660397 -0.18431662 -1.40513021 -0.086437194
##  [6,] -0.81909240 -0.1676902 -0.54908536 -0.74016050 -0.236474920
##  [7,]  0.05376269 -0.5908075  0.31703268  0.18833704 -0.499518748
##  [8,] -0.28068515 -0.7629989 -1.59389395  0.79457871 -1.140023578
##  [9,] -0.36705927 -0.8312342 -0.42775068  1.03779957  0.008399549
## [10,] -0.62030651 -2.0346303 -2.02538526 -0.02526488  1.221197562
##             [,6]       [,7]        [,8]       [,9]      [,10]
##  [1,] -1.6928408  1.0796330  0.15129322 -0.3928271  0.3244993
##  [2,] -0.3931872  0.8898965  0.49298656 -1.2810530  1.2531007
##  [3,] -0.4616952 -0.6183681  0.22511331 -1.2305729 -1.7863763
##  [4,] -0.3648188  1.6917441  0.18510313 -2.1712599  1.1340606
##  [5,] -1.0641780  0.5390542  1.00226442 -0.4819443 -1.5986697
##  [6,] -1.7715321 -0.5724673  1.34880575 -0.9863196  0.8158822
##  [7,] -1.2075057  0.9654406  1.72723195 -1.0775822  0.4496052
##  [8,]  1.7286381 -0.7166731 -1.68613956 -0.7659473  0.7201520
##  [9,] -0.7288765 -0.2405251 -0.90950769 -0.5316522  0.6196387
## [10,] -1.8268438  0.2846441  0.01425084  0.3289314 -0.2076948
```

```r
replicate(10, rnorm(10), simplify = TRUE)
```

```
##             [,1]       [,2]        [,3]        [,4]        [,5]       [,6]
##  [1,] -0.3512138  0.6259734 -3.20190439 -0.27267853  0.05409558 -1.3340205
##  [2,] -0.8608751  0.3306861  0.67749134  1.39315018 -1.07278906  1.6094930
##  [3,]  2.1521573  1.8797241  0.17532399 -0.02747483 -0.20618268 -0.6316676
##  [4,] -0.1198010 -0.7835236 -2.06014814 -1.60129389 -0.98859278  0.7569917
##  [5,] -0.9930953 -1.0540057 -0.21390070 -0.58874184 -0.88719963 -0.6764240
##  [6,] -0.8227631  0.5544352  0.06877954  0.29581791 -1.32606429 -0.6930437
##  [7,]  1.0139031  0.2677677  0.86410580 -0.25864625  0.33081972 -1.4802948
##  [8,]  0.6065159  1.0086888  0.85233016 -0.32370533  1.22022379 -0.3801561
##  [9,]  1.2278801 -1.6789192 -0.51706269  1.22233056  0.42459205 -1.2515101
## [10,] -0.2331130  0.4197695  0.24292929  0.37619528 -0.08205994  1.1639018
##              [,7]       [,8]       [,9]      [,10]
##  [1,]  0.65907257 -0.2566735 -1.1694030 -0.6142019
##  [2,] -0.30292229  0.4698645 -0.6780853  0.2846519
##  [3,] -0.43925926  0.8716297 -0.5650779  0.6136231
##  [4,]  2.45274399  0.1927489  1.4988296  0.6750459
##  [5,] -0.24825590  0.4749198 -0.6875208 -2.2079028
##  [6,] -1.26488476  1.1907319 -1.0161117  0.3120719
##  [7,] -1.84167926  0.3120864 -0.6201099  0.2473528
##  [8,]  0.66502524  0.2479487  0.3234154  1.6908356
##  [9,] -0.30326824  0.6925928  0.1546057 -1.1532834
## [10,]  0.04846152  0.9326981 -1.3333610  0.9010538
```

The final arguments turns the result into a vector or matrix if possible.

## mapply
Its more or less a multivariate version of `sapply`. It applies a function to all corresponding elements of each argument. 

example:


```r
list_1 <- list(a = c(1:10), b = c(11:20))
list_1
```

```
## $a
##  [1]  1  2  3  4  5  6  7  8  9 10
## 
## $b
##  [1] 11 12 13 14 15 16 17 18 19 20
```

```r
list_2 <- list(c = c(21:30), d = c(31:40))
list_2
```

```
## $c
##  [1] 21 22 23 24 25 26 27 28 29 30
## 
## $d
##  [1] 31 32 33 34 35 36 37 38 39 40
```

```r
mapply(sum, list_1$a, list_1$b, list_2$c, list_2$d)
```

```
##  [1]  64  68  72  76  80  84  88  92  96 100
```



